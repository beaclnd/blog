{"componentChunkName":"component---src-templates-blog-post-js","path":"/note-docker-build-with-url-error-initializing-submodules/","result":{"data":{"site":{"siteMetadata":{"title":"beaclnd92's Blog","author":{"name":"beaclnd92","summary":"who keeps learning and thinking"}}},"markdownRemark":{"id":"cecae878-aed9-5a64-9878-bb9690307969","excerpt":"环境 问题描述 使用docker-compose运行容器，在此过程中需要向远程代码库获取源码以Build镜像，结果输出错误信息： 解决方法 经过一番google后，发现是由于使用的Docker版本与Git版本不匹配导致的。 因为Docker 19在运行之后还会运行命令, 若Git版本低于2.1…","html":"<h3>环境</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- OS: Centos 7.9.2009\n- Docker: 19.03.13\n- docker-compose: 1.27.4</code></pre></div>\n<h3>问题描述</h3>\n<p>使用docker-compose运行容器，在此过程中需要向远程代码库获取源码以Build镜像，结果输出错误信息：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">error initializing submodules: usage: <span class=\"token function\">git</span> submodule <span class=\"token punctuation\">[</span>--quiet<span class=\"token punctuation\">]</span> <span class=\"token function\">add</span> <span class=\"token punctuation\">[</span>-b <span class=\"token operator\">&lt;</span>branch<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>-f<span class=\"token operator\">|</span>--force<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--name <span class=\"token operator\">&lt;</span>name<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--reference <span class=\"token operator\">&lt;</span>repository<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span>repository<span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>path<span class=\"token operator\">></span><span class=\"token punctuation\">]</span>\n   or: <span class=\"token function\">git</span> submodule <span class=\"token punctuation\">[</span>--quiet<span class=\"token punctuation\">]</span> status <span class=\"token punctuation\">[</span>--cached<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--recursive<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>path<span class=\"token operator\">></span><span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span>\n   or: <span class=\"token function\">git</span> submodule <span class=\"token punctuation\">[</span>--quiet<span class=\"token punctuation\">]</span> init <span class=\"token punctuation\">[</span>--<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>path<span class=\"token operator\">></span><span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span>\n   or: <span class=\"token function\">git</span> submodule <span class=\"token punctuation\">[</span>--quiet<span class=\"token punctuation\">]</span> deinit <span class=\"token punctuation\">[</span>-f<span class=\"token operator\">|</span>--force<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span>path<span class=\"token operator\">></span><span class=\"token punctuation\">..</span>.\n   or: <span class=\"token function\">git</span> submodule <span class=\"token punctuation\">[</span>--quiet<span class=\"token punctuation\">]</span> update <span class=\"token punctuation\">[</span>--init<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--remote<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>-N<span class=\"token operator\">|</span>--no-fetch<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>-f<span class=\"token operator\">|</span>--force<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--rebase<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--reference <span class=\"token operator\">&lt;</span>repository<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--merge<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--recursive<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>path<span class=\"token operator\">></span><span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span>\n   or: <span class=\"token function\">git</span> submodule <span class=\"token punctuation\">[</span>--quiet<span class=\"token punctuation\">]</span> summary <span class=\"token punctuation\">[</span>--cached<span class=\"token operator\">|</span>--files<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--summary-limit <span class=\"token operator\">&lt;</span>n<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>commit<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>path<span class=\"token operator\">></span><span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span>\n   or: <span class=\"token function\">git</span> submodule <span class=\"token punctuation\">[</span>--quiet<span class=\"token punctuation\">]</span> foreach <span class=\"token punctuation\">[</span>--recursive<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span>command<span class=\"token operator\">></span>\n   or: <span class=\"token function\">git</span> submodule <span class=\"token punctuation\">[</span>--quiet<span class=\"token punctuation\">]</span> <span class=\"token function\">sync</span> <span class=\"token punctuation\">[</span>--recursive<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>path<span class=\"token operator\">></span><span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span>\n<span class=\"token builtin class-name\">:</span> <span class=\"token builtin class-name\">exit</span> status <span class=\"token number\">1</span></code></pre></div>\n<h3>解决方法</h3>\n<p>经过一番google后，发现是由于使用的Docker版本与Git版本不匹配导致的。</p>\n<p>因为Docker 19在运行<code class=\"language-text\">git clone</code>之后还会运行命令<code class=\"language-text\">git submodule update --init --recursive --depth=1</code>, 若Git版本低于2.10则无法识别参数<code class=\"language-text\">--depth</code>，CentOS 7.9默认能安装的Git版本为1.8，故出现了上述错误。</p>\n<p>解决方法可以是：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- 降低Docker的版本\n- 升级Git的版本</code></pre></div>\n<p>我选择了升级Git的版本，首先卸载老版本Git，然后为CentOS 7.9添加Endpoint仓库，接着安装新版本Git:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ yum remove git*\n$ yum -y <span class=\"token function\">install</span> https://packages.endpoint.com/rhel/7/os/x86_64/endpoint-repo-1.7-1.x86_64.rpm\n$ yum <span class=\"token function\">install</span> -y <span class=\"token function\">git</span>\n$ <span class=\"token function\">git</span> --version\n<span class=\"token function\">git</span> version <span class=\"token number\">2.24</span>.1</code></pre></div>\n<p>最终问题得以解决。</p>\n<h3>参考</h3>\n<ol>\n<li><a href=\"https://forums.docker.com/t/build-with-url-error/48638\">https://forums.docker.com/t/build-with-url-error/48638</a></li>\n<li><a href=\"https://computingforgeeks.com/how-to-install-latest-version-of-git-git-2-x-on-centos-7\">https://computingforgeeks.com/how-to-install-latest-version-of-git-git-2-x-on-centos-7</a></li>\n</ol>","frontmatter":{"title":"笔记： 踩坑——Docker基于URL进行Build时出错","date":"2020/12/01","description":"Docker基于远程Git URL进行镜像Build时，遇到错误信息： error initializing submodules: usage: git submodule","tags":["笔记","踩坑","Docker"]},"fields":{"readingTime":{"text":"1 min read"}}}},"pageContext":{"slug":"/note-docker-build-with-url-error-initializing-submodules/","previous":{"fields":{"slug":"/tls-mutual-authentication/"},"frontmatter":{"title":"双向身份验证HTTPS/TLS连接试验"}},"next":{"fields":{"slug":"/free-tls-certificate-with-letsencrypt/"},"frontmatter":{"title":"为网站申请免费TLS/SSL证书"}}}}}