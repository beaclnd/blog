{"componentChunkName":"component---src-templates-blog-post-js","path":"/notes-for-docker-usage/","result":{"data":{"site":{"siteMetadata":{"title":"beaclnd92's Blog","author":{"name":"beaclnd92","summary":"who keeps learning and thinking"}}},"markdownRemark":{"id":"6f1c1798-a3fa-51e6-bd15-ba1173f8bd91","excerpt":"host网络模式 运行Docker容器时，可使用参数来使得可从容器内通过来访问宿主机中运行的其他服务，容器和宿主机将共享网络空间，也无需端口映射配置。 此外，使用host模式在容器内使用localhost或127.0.0.1访问宿主机服务只在Linux中有效。 Mac或Windows中的Docker Desktop…","html":"<h3>host网络模式</h3>\n<p>运行Docker容器时，可使用参数<code class=\"language-text\">--network host</code>来使得可从容器内通过<code class=\"language-text\">localhost:&lt;port&gt;</code>来访问宿主机中运行的其他服务，容器和宿主机将共享网络空间，也无需端口映射配置。</p>\n<p>此外，使用host模式在容器内使用localhost或127.0.0.1访问宿主机服务只在Linux中有效。</p>\n<p>Mac或Windows中的Docker Desktop现不支持localhost访问宿主机，但18.08+版本可支持使用host.docker.internal访问宿主机。</p>\n<h3>docker虚拟网卡默认ip</h3>\n<p>在默认配置下，启动docker daemon服务将会生成虚拟网卡docker0，并自动设置其ip为172.17.0.1/16，且自动在操作系统路由表中添加记录项以将所有目标地址与网段172.17.0.0/16相匹配的请求路由到docker0网卡。若宿主机对外使用的ip(如172.17.23.89)恰好能匹配该网段，则会导致后续外部远程连接该宿主机失败。</p>\n<p>同样地，默认情况下使用docker-compose启动容器时，docker-compose.yml中的容器网络配置若是bridge网络驱动(默认配置)，则会产生名为br-xxxxx的虚拟网卡，并自动设置其ip为172.18.0.1/16，其自动在操作系统路由表中添加记录项以将所有目标地址与网段172.18.0.0/16相匹配的请求路由到br-xxxxx网卡。若宿主机对外使用的ip(如172.18.86.22)恰好能匹配该网段，则会导致远程连接该宿主机失败。</p>\n<p>可以通过修改docker配置文件：<code class=\"language-text\">/etc/docker/daemon.json</code>，同时更改上述docker0及br-xxxx虚拟网卡的默认ip及路由表中匹配的网段地址以避免与宿主机ip冲突。如下所示，在该配置文件中使用配置：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\n    &quot;default-address-pools&quot;: [\n        {\n            &quot;base&quot;: &quot;172.31.0.0/16&quot;,\n            &quot;size&quot;: 24\n        }\n    ]\n}</code></pre></div>\n<p>使用上述配置后，启动或重启docker daemon服务。则docker0网卡和br-xxxx网卡会被分别分配ip：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker0: 172.31.0.1/24\nbr-xxxx: 172.31.1.1/24</code></pre></div>\n<p>路由表中的记录项所匹配的网段将分别为：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">172.31.0.0/24: docker0\n172.31.1.0/24: br-xxxx</code></pre></div>","frontmatter":{"title":"笔记： 踩坑——Docker使用错误及经验总结","date":"2021/10/17","description":"对自己在使用Docker时遇到的错误及经验进行梳理与总结","tags":["笔记","踩坑","Docker"]},"fields":{"readingTime":{"text":"1 min read"}}}},"pageContext":{"slug":"/notes-for-docker-usage/","previous":{"fields":{"slug":"/notes-for-shell-script/"},"frontmatter":{"title":"笔记： 踩坑——Shell脚本错误及经验总结"}},"next":{"fields":{"slug":"/notes-for-git-with-ssh-failed/"},"frontmatter":{"title":"笔记： 踩坑——使用git经ssh协议向远程推送或拉取代码库时出错"}}}}}